<!DOCTYPE html>
<html lang="zh-Hant">
<head>
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <meta charset="utf-8"/>
  <title>神魔圖鑒</title>
 <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: flex-start;
      flex-direction: column;
      height: 100vh;
    }
    .gallery {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 10px;
      justify-items: center;
      width: 100%;
      max-width: 1200px;
      margin-top: 80px;
    }
    .monster {
      width: 142px;
      text-align: center;
      padding: 8px;
      box-sizing: border-box;
      border: 1px solid #ccc;
    }
    .monster img {
      width: 80px;
      height: 80px;
      object-fit: contain;
      display: block;
      margin: 0 auto 8px;
    }
    .search-bar-wrapper {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 60px;
      background: #ffffff;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      z-index: 999;
      display: flex;
      align-items: center;
    }
    .search-bar {
      width: 25%;
      margin-left: 20px;
      background: #fff;
      padding: 10px 20px;
      box-sizing: border-box;
      border-radius: 6px;
      position: relative;
      z-index: 1000;
    }
    .search-bar input {
      width: 100%;
      padding: 8px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .dropdown {
      position: relative;
      margin-left: 10px;
    }
    .dropdown-button {
      background: #fff;
      padding: 8px 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
      display: flex;
      align-items: center;
      font-size: 14px;
      cursor: pointer;
      transition: border-color 0.3s;
    }
    .dropdown-button:hover {
      border-color: #888;
    }
    .dropdown-button img {
      width: 24px;
      height: 24px;
      margin-right: 8px;
    }
    .dropdown-content {
      display: none;
      opacity: 0;
      position: absolute;
      top: 100%;
      left: 0;
      background-color: #fff;
      border: 1px solid #ccc;
      box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.1);
      z-index: 1;
      min-width: max-content;
      padding: 4px 0;
      border-radius: 6px;
      transition: opacity 0.3s ease;
    }
    .dropdown-content.show {
      display: block;
      opacity: 1;
    }
    .dropdown-item {
      padding: 6px 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      font-size: 14px;
      transition: background-color 0.2s;
    }
    .dropdown-item:hover {
      background-color: #f0f0f0;
    }
    .dropdown-item img {
      width: 24px;
      height: 24px;
      margin-right: 10px;
    }
    .dropdown-item.selected {
      opacity: 0.4;
      pointer-events: none;
    }
	#scrollButtons {
	  position: fixed;
	  right: 20px;
	  bottom: 20px;
	  display: none;
	  flex-direction: column;
	  gap: 10px;
	  z-index: 999;
	}

	#scrollButtons button {
	  padding: 10px 12px;
	  font-size: 14px;
	  border: none;
	  border-radius: 8px;
	  background-color: #333;
	  color: white;
	  cursor: pointer;
	  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
	  transition: background-color 0.3s ease;
	}

	#scrollButtons button:hover {
	  background-color: #555;
	}
	#resetFilters {
	  padding: 8px;
	  border: none;
	  background: none;
	  display: flex;
	  align-items: center;
	  justify-content: center;
	  cursor: pointer;
	}
	#resetFilters img {
	  width: 30px;
	  height: 30px;
	  object-fit: contain;
	}
	.monster-info {
	  max-height: 0;
	  overflow: hidden;
	  transition: max-height 0.3s ease;
	  font-size: 14px;
	  margin-top: 6px;
	  color: #444;
	}

	.monster.show-info .monster-info {
	  max-height: 150px;
	}
  </style>
</head>
<body>
  <div class="search-bar-wrapper">
    <div class="search-bar">
      <input id="searchInput" onkeyup="filterMonsters()" placeholder="輸入卡片編號或名稱..." type="text"/>
    </div>

    <!-- 屬性 -->
    <div class="dropdown" id="attributeDropdown">
      <div class="dropdown-button dropdown-trigger">
        <div class="selected-icons"></div>
        <span>屬性</span>
      </div>
      <div class="dropdown-content" id="attributeContent">
        <div class="dropdown-item" data-value="1"><img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/checkup/tag-selectors/water.png" alt="水"></div>
        <div class="dropdown-item" data-value="2"><img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/checkup/tag-selectors/fire.png" alt="火"></div>
        <div class="dropdown-item" data-value="3"><img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/checkup/tag-selectors/earth.png" alt="木"></div>
        <div class="dropdown-item" data-value="4"><img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/checkup/tag-selectors/light.png" alt="光"></div>
        <div class="dropdown-item" data-value="5"><img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/checkup/tag-selectors/dark.png" alt="暗"></div>
      </div>
    </div>

    <!-- 種族 -->
    <div class="dropdown" id="raceDropdown">
      <div class="dropdown-button dropdown-trigger">
        <div class="selected-icons"></div>
        <span>種族</span>
      </div>
      <div class="dropdown-content" id="raceContent">
        <div class="dropdown-item" data-value="1"><img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/checkup/tag-selectors/human.png" alt="人"></div>
        <div class="dropdown-item" data-value="2"><img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/checkup/tag-selectors/animal.png" alt="獸"></div>
        <div class="dropdown-item" data-value="3"><img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/checkup/tag-selectors/fairy.png" alt="妖"></div>
        <div class="dropdown-item" data-value="4"><img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/checkup/tag-selectors/dragon.png" alt="龍"></div>
        <div class="dropdown-item" data-value="5"><img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/checkup/tag-selectors/god.png" alt="神"></div>
        <div class="dropdown-item" data-value="8"><img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/checkup/tag-selectors/devil.png" alt="魔"></div>
        <div class="dropdown-item" data-value="10"><img src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/checkup/tag-selectors/mech.png" alt="機械"></div>
		<div class="dropdown-item" data-value="6"><img src="https://i.postimg.cc/zbDvRhPc/evolve.png" alt="進化"></div>
		<div class="dropdown-item" data-value="7"><img src="https://i.postimg.cc/cKB6HhT3/level.png" alt="強化"></div>
      </div>
    </div>

    <button id="resetFilters" style="margin-left: 10px; padding: 8px 16px;"><img src = 'https://i.postimg.cc/X7SptCXY/SI125.png'></button>
  </div>

  <div class="gallery" id="monsterGallery">
    <div class="monster" data-attribute="1" data-id="0001" data-name="莫莉" data-race="1">
      <div>0001</div>
      <img alt="0001" onerror="this.onerror=null;this.src='https://kennylou92.github.io/tos_story/Img/default.png';" src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/0001.jpg"/>
      <div>莫莉</div>
	  <div class = 'monster-info'></div>
    </div>
<div class="monster" data-attribute="1" data-id="0002" data-name="高級水術士莫莉" data-race="1">
    <div>
     0002
    </div>
    <img alt="0002" onerror="this.onerror=null;this.src='https://kennylou92.github.io/tos_story/Img/default.png';" src="https://d1h5mn9kk900cf.cloudfront.net/toswebsites/gallery/icons/0002.jpg"/>
    <div>
     高級水術士莫莉
    </div>
	<div class = 'monster-info'></div>
   </div>
  </div>
<script>
let selectedAttributes = new Set();
let selectedRaces = new Set();

document.querySelectorAll(".dropdown").forEach(dropdown => {
  const trigger = dropdown.querySelector(".dropdown-trigger");
  const content = dropdown.querySelector(".dropdown-content");

  trigger.addEventListener("click", () => {
    content.classList.toggle("show");
  });
});

document.addEventListener("click", function(event) {
  document.querySelectorAll(".dropdown-content").forEach(content => {
    if (!content.parentElement.contains(event.target)) {
      content.classList.remove("show");
    }
  });
});

function updateSelectedIcons(containerId, selectedSet) {
  const container = document.querySelector(#${containerId} .selected-icons);
  const items = document.querySelectorAll(#${containerId} .dropdown-item);
  const label = document.querySelector(#${containerId} .dropdown-button span);
  container.innerHTML = '';

  selectedSet.forEach(value => {
    items.forEach(item => {
      if (item.dataset.value === value) {
        const img = item.querySelector('img').cloneNode();
        img.style.width = '20px';
        img.style.height = '20px';
        container.appendChild(img);
      }
    });
  });
// 根據是否有選擇來顯示或隱藏標題文字
  if (selectedSet.size > 0) {
    label.style.display = 'none';
  } else {
    label.style.display = 'inline';
  }
} 

document.querySelectorAll('#attributeContent .dropdown-item').forEach(item => {
  item.addEventListener('click', function () {
    const value = this.getAttribute('data-value');
    this.classList.toggle('selected');

    if (selectedAttributes.has(value)) {
      selectedAttributes.delete(value);
    } else {
      selectedAttributes.add(value);
    }
    updateSelectedIcons('attributeDropdown', selectedAttributes);
    filterMonsters();
  });
});

document.querySelectorAll('#raceContent .dropdown-item').forEach(item => {
  item.addEventListener('click', function () {
    const value = this.getAttribute('data-value');
    this.classList.toggle('selected');

    if (selectedRaces.has(value)) {
      selectedRaces.delete(value);
    } else {
      selectedRaces.add(value);
    }
    updateSelectedIcons('raceDropdown', selectedRaces);
    filterMonsters();
  });
});

function filterMonsters() {
  const searchTerm = document.getElementById("searchInput").value.trim().toLowerCase();
  const monsters = document.querySelectorAll(".monster");

  monsters.forEach(monster => {
    const name = monster.querySelector("div:nth-child(3)").textContent.toLowerCase();
    const id = monster.querySelector("div:nth-child(1)").textContent.toLowerCase();
    const attribute = monster.getAttribute('data-attribute');
    const race = monster.getAttribute('data-race');

    const matchesSearch = name.includes(searchTerm) || id.includes(searchTerm);
    const matchesAttribute = selectedAttributes.size === 0 || selectedAttributes.has(attribute);
    const matchesRace = selectedRaces.size === 0 || selectedRaces.has(race);

    monster.style.display = (matchesSearch && matchesAttribute && matchesRace) ? "block" : "none";
  });
}

document.getElementById("resetFilters").addEventListener("click", () => {
  selectedAttributes.clear();
  selectedRaces.clear();

  document.querySelectorAll('.dropdown-item.selected').forEach(item => {
    item.classList.remove('selected');
  });

  document.querySelectorAll('.selected-icons').forEach(iconBox => {
    iconBox.innerHTML = '';
  });
  document.getElementById("searchInput").value = '';
  // ➕ 加上這兩行讓標題回來
  updateSelectedIcons('attributeDropdown', selectedAttributes);
  updateSelectedIcons('raceDropdown', selectedRaces);
  
  filterMonsters();
});
// 顯示 / 隱藏按鈕
window.addEventListener('scroll', () => {
  const scrollBtn = document.getElementById('scrollButtons');
  if (window.scrollY > 200) {
    scrollBtn.style.display = 'flex';
  } else {
    scrollBtn.style.display = 'none';
  }
});

// 滾動功能
function scrollToTop() {
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function scrollToBottom() {
  window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
}
let monsterData = {};

// 載入 JSON 資料
fetch('monster.json')
  .then(res => res.json())
  .then(data => {
    data.forEach(mon => {
      monsterData[mon.id] = mon;  // 用 id 當 key 存起來
    });
  });

document.querySelectorAll('.monster').forEach(monster => {
  monster.addEventListener('click', () => {
    // 收起其他怪物 info
    document.querySelectorAll('.monster.show-info').forEach(m => {
      if (m !== monster) m.classList.remove('show-info');
    });

    const id = monster.dataset.id;  // 確保這是四位數字的字串
    const infoBox = monster.querySelector('.monster-info');

    // 用來打印資料檢查
    console.log(查詢 id: ${id});
    console.log(monsterData:, monsterData);

    const data = monsterData[id];  // 使用字串型態的 id 查詢

    if (data && infoBox) {
      infoBox.innerHTML = 
        <div>HP：${data.HP}</div>
        <div>ATK：${data.ATK}</div>
        <div>REC：${data.REC}</div>
      ;
    } else {
      infoBox.innerHTML = '<div>找不到資料</div>';
    }

    monster.classList.toggle('show-info');
  });
});


</script>
<!-- 回頂部 / 到最底按鈕 -->
<div id="scrollButtons">
  <button onclick="scrollToTop()"><i class="fas fa-arrow-up"></i></button>
  <button onclick="scrollToBottom()"><i class="fas fa-arrow-down"></i></button>
</body>
</html>